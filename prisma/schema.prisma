generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Institution {
  id                String   @id
  name              String
  createdAt         DateTime @default(now())
  logoUrl           String?
  shortName         String?
  created_at_string String?  @default(dbgenerated("timestamp_to_string(\"createdAt\")"))
  items             Item[]
}

model Item {
  id                     String         @id @default(cuid())
  plaidItemId            String         @unique
  accessToken            String
  institutionId          String?
  status                 String?
  lastTransactionsCursor String?
  lastInvestmentsCursor  String?
  createdAt              DateTime       @default(now())
  updatedAt              DateTime       @updatedAt
  created_at_string      String?        @default(dbgenerated("timestamp_to_string(\"createdAt\")"))
  updated_at_string      String?        @default(dbgenerated("timestamp_to_string(\"updatedAt\")"))
  institution            Institution?   @relation(fields: [institutionId], references: [id])
  accounts               PlaidAccount[]
}

model PlaidAccount {
  id                        String                  @id @default(cuid())
  plaidAccountId            String                  @unique
  itemId                    String
  name                      String
  officialName              String?
  mask                      String?
  type                      String
  subtype                   String?
  currency                  String?
  createdAt                 DateTime                @default(now())
  updatedAt                 DateTime                @updatedAt
  availableBalance          Decimal?                @db.Decimal(14, 2)
  balanceUpdatedAt          DateTime?
  creditLimit               Decimal?                @db.Decimal(14, 2)
  currentBalance            Decimal?                @db.Decimal(14, 2)
  current_balance_number    Float?                  @default(dbgenerated("(\"currentBalance\")::double precision"))
  available_balance_number  Float?                  @default(dbgenerated("(\"availableBalance\")::double precision"))
  credit_limit_number       Float?                  @default(dbgenerated("(\"creditLimit\")::double precision"))
  balance_updated_at_string String?                 @default(dbgenerated("timestamp_to_string(\"balanceUpdatedAt\")"))
  created_at_string         String?                 @default(dbgenerated("timestamp_to_string(\"createdAt\")"))
  updated_at_string         String?                 @default(dbgenerated("timestamp_to_string(\"updatedAt\")"))
  holdings                  Holding[]
  investmentTxns            InvestmentTransaction[]
  item                      Item                    @relation(fields: [itemId], references: [id])
  transactions              Transaction[]
}

model Transaction {
  id                     String        @id @default(cuid())
  plaidTransactionId     String        @unique
  accountId              String
  amount                 Decimal       @db.Decimal(14, 2)
  isoCurrencyCode        String?
  date                   DateTime
  authorizedDate         DateTime?
  datetime               String
  authorizedDatetime     String?
  pending                Boolean
  merchantName           String?
  name                   String
  plaidCategory          String?
  plaidSubcategory       String?
  paymentChannel         String?
  pendingTransactionId   String?
  createdAt              DateTime      @default(now())
  updatedAt              DateTime      @updatedAt
  categoryIconUrl        String?
  logoUrl                String?
  categoryId             String?
  subcategoryId          String?
  notes                  String?
  isSplit                Boolean       @default(false)
  isManual               Boolean       @default(false)
  originalTransactionId  String?
  parentTransactionId    String?
  amount_number          Float?        @default(dbgenerated("((amount * -1))::double precision"))
  created_at_string      String?       @default(dbgenerated("timestamp_to_string(\"createdAt\")"))
  updated_at_string      String?       @default(dbgenerated("timestamp_to_string(\"updatedAt\")"))
  account                PlaidAccount  @relation(fields: [accountId], references: [id])
  category               Category?     @relation(fields: [categoryId], references: [id])
  subcategory            Subcategory?  @relation(fields: [subcategoryId], references: [id])
  parentTransaction      Transaction?  @relation("TransactionSplits", fields: [parentTransactionId], references: [id], onDelete: Cascade)
  childTransactions      Transaction[] @relation("TransactionSplits")
  tags                   TransactionTag[]

  @@index([plaidTransactionId])
  @@index([parentTransactionId])
  @@index([originalTransactionId])
}

model Security {
  id                String                  @id @default(cuid())
  plaidSecurityId   String                  @unique
  name              String?
  tickerSymbol      String?
  type              String?
  isoCurrencyCode   String?
  createdAt         DateTime                @default(now())
  updatedAt         DateTime                @updatedAt
  logoUrl           String?
  created_at_string String?                 @default(dbgenerated("timestamp_to_string(\"createdAt\")"))
  updated_at_string String?                 @default(dbgenerated("timestamp_to_string(\"updatedAt\")"))
  holdings          Holding[]
  investmentTx      InvestmentTransaction[]
}

model Holding {
  id                             String       @id @default(cuid())
  accountId                      String
  securityId                     String
  quantity                       Decimal      @db.Decimal(20, 8)
  costBasis                      Decimal?     @db.Decimal(20, 8)
  institutionPrice               Decimal?     @db.Decimal(20, 8)
  institutionPriceAsOf           DateTime?
  isoCurrencyCode                String?
  createdAt                      DateTime     @default(now())
  updatedAt                      DateTime     @updatedAt
  quantity_number                Float?       @default(dbgenerated("(quantity)::double precision"))
  cost_basis_number              Float?       @default(dbgenerated("(\"costBasis\")::double precision"))
  institution_price_number       Float?       @default(dbgenerated("(\"institutionPrice\")::double precision"))
  institution_price_as_of_string String?      @default(dbgenerated("timestamp_to_string(\"institutionPriceAsOf\")"))
  created_at_string              String?      @default(dbgenerated("timestamp_to_string(\"createdAt\")"))
  updated_at_string              String?      @default(dbgenerated("timestamp_to_string(\"updatedAt\")"))
  account                        PlaidAccount @relation(fields: [accountId], references: [id])
  security                       Security     @relation(fields: [securityId], references: [id])
}

model InvestmentTransaction {
  id                           String       @id @default(cuid())
  plaidInvestmentTransactionId String       @unique
  accountId                    String
  securityId                   String?
  type                         String
  amount                       Decimal?     @db.Decimal(20, 8)
  price                        Decimal?     @db.Decimal(20, 8)
  quantity                     Decimal?     @db.Decimal(20, 8)
  fees                         Decimal?     @db.Decimal(20, 8)
  isoCurrencyCode              String?
  date                         DateTime
  transactionDatetime          String?
  name                         String?
  createdAt                    DateTime     @default(now())
  updatedAt                    DateTime     @updatedAt
  amount_number                Float?       @default(dbgenerated("(amount)::double precision"))
  price_number                 Float?       @default(dbgenerated("(price)::double precision"))
  quantity_number              Float?       @default(dbgenerated("(quantity)::double precision"))
  fees_number                  Float?       @default(dbgenerated("(fees)::double precision"))
  created_at_string            String?      @default(dbgenerated("timestamp_to_string(\"createdAt\")"))
  updated_at_string            String?      @default(dbgenerated("timestamp_to_string(\"updatedAt\")"))
  account                      PlaidAccount @relation(fields: [accountId], references: [id])
  security                     Security?    @relation(fields: [securityId], references: [id])

  @@index([plaidInvestmentTransactionId])
}

model Tag {
  id                String           @id @default(cuid())
  name              String           @unique
  color             String
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  created_at_string String?          @default(dbgenerated("timestamp_to_string(\"createdAt\")"))
  updated_at_string String?          @default(dbgenerated("timestamp_to_string(\"updatedAt\")"))
  transactions      TransactionTag[]
}

model TransactionTag {
  id                String      @id @default(cuid())
  transactionId     String
  tagId             String
  createdAt         DateTime    @default(now())
  created_at_string String?     @default(dbgenerated("timestamp_to_string(\"createdAt\")"))
  tag               Tag         @relation(fields: [tagId], references: [id], onDelete: Cascade)
  transaction       Transaction @relation(fields: [transactionId], references: [id], onDelete: Cascade)

  @@unique([transactionId, tagId])
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String    @unique
  emailVerified Boolean   @default(false)
  image         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  accounts      Account[]
  sessions      Session[]
}

model Session {
  id        String   @id @default(cuid())
  userId    String
  expiresAt DateTime
  ipAddress String?
  userAgent String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  token     String   @unique
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Account {
  id                    String    @id @default(cuid())
  userId                String
  providerId            String
  accountId             String
  accessToken           String?
  refreshToken          String?
  expiresAt             DateTime?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  accessTokenExpiresAt  DateTime?
  idToken               String?
  password              String?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([providerId, accountId], map: "OAuthAccount_provider_providerId_key")
  @@index([userId])
}

model Verification {
  id         String   @id @default(cuid())
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([identifier, value])
}

enum CategoryGroupType {
  EXPENSES
  INCOME
  INVESTMENT
}

model Category {
  id                  String             @id @default(cuid())
  name                String
  imageUrl            String?
  groupType           CategoryGroupType?
  displayOrder        Int?
  isTransferCategory  Boolean            @default(false)
  createdAt           DateTime           @default(now())
  updatedAt           DateTime           @updatedAt
  created_at_string   String?            @default(dbgenerated("timestamp_to_string(\"createdAt\")"))
  updated_at_string   String?            @default(dbgenerated("timestamp_to_string(\"updatedAt\")"))
  subcategories       Subcategory[]
  transactions        Transaction[]
}

model Subcategory {
  id                String        @id @default(cuid())
  categoryId        String
  name              String
  imageUrl          String?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  created_at_string String?       @default(dbgenerated("timestamp_to_string(\"createdAt\")"))
  updated_at_string String?       @default(dbgenerated("timestamp_to_string(\"updatedAt\")"))
  category          Category      @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  transactions      Transaction[]
}
